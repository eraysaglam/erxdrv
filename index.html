<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ErX Driver</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', sans-serif;
      height: 100%;
      overflow: hidden;
      background: white;
    }
    #appStart {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      flex-direction: column;
    }
    .start-button {
      background-color: #007bff;
      color: white;
      padding: 16px 30px;
      margin: 10px;
      border: none;
      border-radius: 30px;
      font-size: 18px;
      cursor: pointer;
    }
    #mapWrapper {
      display: none;
    }
    #map {
      position: absolute;
      height: 100vh;
      width: 100%;
      z-index: 0;
    }
    .sidebar {
      position: fixed;
      top: 0;
      left: 0;
      bottom: 0;
      width: 220px;
      background-color: #111;
      color: white;
      padding: 20px;
      z-index: 1000;
    }
    .sidebar ul {
      list-style: none;
      padding: 0;
    }
    .sidebar ul li {
      padding: 10px 0;
      border-bottom: 1px solid #444;
      cursor: pointer;
    }
    .sidebar ul li:hover {
      background-color: #222;
    }
    .earnings {
      position: fixed;
      top: 20px;
      right: 20px;
      background-color: #000;
      color: #0f0;
      font-size: 18px;
      padding: 10px 20px;
      border-radius: 10px;
      z-index: 1001;
    }
    .status-button {
      position: fixed;
      bottom: 30px;
      right: 30px;
      z-index: 2000;
      background-color: #28a745;
      color: white;
      padding: 12px 20px;
      border: none;
      border-radius: 25px;
      font-size: 16px;
      cursor: pointer;
    }
    .offer-box {
      position: fixed;
      bottom: -400px;
      right: 30px;
      width: 300px;
      background: white;
      border: 2px solid #222;
      border-radius: 15px;
      padding: 20px;
      z-index: 9999;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      transition: all 0.5s ease;
      opacity: 0;
    }
    .offer-box.visible {
      bottom: 30px;
      opacity: 1;
    }
    .offer-box h3 {
      margin-top: 0;
    }
    .offer-buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 10px;
    }
    .offer-buttons button {
      flex: 1;
      margin: 0 5px;
      padding: 10px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
    }
    .offer-buttons button:first-child {
      background-color: #28a745;
      color: white;
    }
    .offer-buttons button:last-child {
      background-color: #dc3545;
      color: white;
    }
  </style>
</head>
<body>

<div id="appStart">
  <button class="start-button" onclick="startAsDriver()">Ben Bir Driver'ım</button>
  <button class="start-button" onclick="alert('Yolcu ekranı yakında aktif olacak!')">Ben Bir Yolcuyum</button>
</div>

<div id="mapWrapper">
  <div class="sidebar">
    <h2>ErX Driver</h2>
    <ul>
      <li onclick="alert('Gelen Kutusu')">📥 Gelen Kutusu</li>
      <li onclick="alert('Tavsiyeler')">💡 Tavsiyeler</li>
      <li onclick="alert('Fırsatlar')">🎁 Fırsatlar</li>
      <li onclick="alert('Kazançlar')">📈 Kazançlar</li>
      <li onclick="alert('Cüzdan')">💳 Cüzdan</li>
      <li onclick="alert('Hesap')">👤 Hesap</li>
      <hr/>
      <li onclick="alert('Eğitim Merkezi')">📚 Eğitim Merkezi</li>
      <li onclick="alert('Yardım Merkezi')">🆘 Yardım Merkezi</li>
      <li onclick="alert('Canlı Destek')">💬 Canlı Destek</li>
    </ul>
  </div>
  <div class="earnings">$89.93</div>
  <div id="map"></div>
  <button class="status-button" id="toggleStatusButton" onclick="toggleOnlineStatus()">GO ONLINE</button>
</div>

<script>
  let vehicles = [];
  let isOnline = false;
  let offerInterval;

  function startAsDriver() {
    document.getElementById("appStart").style.display = "none";
    document.getElementById("mapWrapper").style.display = "block";

    const map = L.map("map").setView([28.3772, -81.5707], 13);

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      attribution: "&copy; OpenStreetMap contributors"
    }).addTo(map);

    const carIcon = L.icon({
      iconUrl: 'https://cdn-icons-png.flaticon.com/512/744/744465.png',
      iconSize: [40, 40],
      iconAnchor: [20, 20]
    });

    const baseLat = 28.3772;
    const baseLng = -81.5707;

    for (let i = 0; i < 70; i++) {
      let lat = baseLat + (Math.random() - 0.5) * 0.01;
      let lng = baseLng + (Math.random() - 0.5) * 0.01;
      const marker = L.marker([lat, lng], { icon: carIcon }).addTo(map);
      vehicles.push({ lat, lng, marker });
    }

    setInterval(() => {
      vehicles.forEach(vehicle => {
        vehicle.lat += (Math.random() - 0.5) * 0.001;
        vehicle.lng += (Math.random() - 0.5) * 0.001;
        vehicle.marker.setLatLng([vehicle.lat, vehicle.lng]);
      });
    }, 1200);
  }

  function toggleOnlineStatus() {
    const btn = document.getElementById('toggleStatusButton');

    if (!isOnline) {
      isOnline = true;
      btn.innerText = 'GO OFFLINE';
      btn.style.backgroundColor = '#dc3545';
      alert('Şu anda ONLINE durumdasınız.');

      offerInterval = setInterval(() => {
        showIncomingOffer();
      }, 20000); // 20 saniyede bir teklif
    } else {
      isOnline = false;
      btn.innerText = 'GO ONLINE';
      btn.style.backgroundColor = '#28a745';
      alert('Şu anda OFFLINE durumdasınız.');

      clearInterval(offerInterval);
    }
  }

  function showIncomingOffer() {
    const pickupAddress = "1234 Main St, Orlando, FL";
    const dropoffAddress = "5678 Palm Ave, Kissimmee, FL";
    const pickupDistance = (Math.random() * 3 + 1).toFixed(1);
    const dropoffDistance = (Math.random() * 10 + 3).toFixed(1);
    const eta = Math.floor(Math.random() * 10 + 5);

    const offerBox = document.createElement('div');
    offerBox.className = 'offer-box';
    offerBox.innerHTML = `
      <h3>📦 Yeni Teklif</h3>
      <p><strong>Alım Noktası:</strong><br>${pickupAddress}</p>
      <p><strong>Sürücüye Uzaklığı:</strong> ${pickupDistance} mil</p>
      <p><strong>Bırakılacak Adres:</strong><br>${dropoffAddress}</p>
      <p><strong>Mesafe:</strong> ${dropoffDistance} mil</p>
      <p><strong>Tahmini Süre:</strong> ${eta} dakika</p>
      <div class="offer-buttons">
        <button onclick="acceptOffer(this.parentElement.parentElement)">✅ Kabul Et</button>
        <button onclick="rejectOffer(this.parentElement.parentElement)">❌ Reddet</button>
      </div>
    `;
    document.body.appendChild(offerBox);

    // Animasyon için sınıf ekle
    setTimeout(() => {
      offerBox.classList.add('visible');
    }, 50);

    // Sesli bildirim
    const audio = new Audio("https://notificationsounds.com/storage/sounds/file-sounds-1152-pristine.mp3");
    audio.play();
  }

  function acceptOffer(offerBox) {
    offerBox.remove();
    alert("Teklif kabul edildi! 🚗 Rota oluşturuluyor...");

    // Örnek kazanç güncellemesi
    const earningsEl = document.querySelector(".earnings");
    const currentEarnings = parseFloat(earningsEl.innerText.replace("$", ""));
    const added = (Math.random() * 10 + 5).toFixed(2);
    earningsEl.innerText = `$${(currentEarnings + parseFloat(added)).toFixed(2)}`;

    // İsteğe bağlı: haritada rota vs. ekleyebiliriz.
  }

  function rejectOffer(offerBox) {
    offerBox.remove();
    alert("Teklif reddedildi.");
  }
</script>
